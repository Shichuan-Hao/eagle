

在分布式架构中，经常会有主从这类集群架构。 那么在主从架构中，当主节点出现崩溃，此时就需要触发一次主从切换的过程。而在一批从节点的集群中如何选出哪个节点是主节点就成了一个非常特殊的问题：选举。

## Bully 算法

简单介绍：在一批存活的节点中，选择ID数最大的那个节点作为新的主节点。

选举过程：
1. 每个节点生成一个id数字，然后传播给其他节点。
2. 收到id的节点将自己的数字与其比较，如果自身的id比这个数字大，就返回给对方信号，说：”我的id值更大“。
3. 按照这种思路，如果有一个节点再通知出去后规定时间内没有收到任何的”我的id值更大“这样一类消息的话，那么该节点就会成为新的主节点。
4. 成为新的主节点的角色，需要再发送一个通知给到其他节点，告知它们与”我“连接。

整体链路如下所示：

所有节点都需要给其他的节点发送消息。因为考虑到网络传输延迟，所以最终选举出新的节点的过程存在一个时间窗口，也就是选举过程中不会有新的主节点产生，这也是主从架构中一定会存在的缺陷。

该算法中涉及到的消息类型有：
1. Election 消息，用来发起选举。
2. Alive 消息，对Election消息的应答。
3. Victory消息，竞选成功的主节点向其他节点发送的宣誓主权的消息。

优点：简单易懂，容易实现
缺点：每个从节点都需要保留所有其他从节点的地址等信息，如果有新的从节点接入，需要通知给其他所有的从节点。