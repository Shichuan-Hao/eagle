
## 单机架构

单机架构的任务：
1. 服务注册
2. 服务下线剔除
3. 心跳检测

本质是一个单节点程序，将数据全部存储在内存中。

为什么不做成分布式存储？（ES，MongoDB，将数据拆解成多份，分别存储在不同的节点上）
1. 原因一是因为服务注册的数据量本身也不太多，单个进程内部用一个map集合进行存储就足够了
2. 原因二是单体存储的时候，查询不需要考虑分片路由那些逻辑，更加简单清晰

单节点注册中心存在的缺陷主要是：一旦节点崩溃之后，后续的Mq链路不可用，不具备高可用和容错能力。


## 集群架构

有两种集群架构的设计模式：
1. 主从架构：主节点负责写入，从节点同步主节点的数据，同时从节点分担读的压力。同步的时候如果从节点过多，会有性能影响。
   1. Master 节点：开启一个独立的netty进程，用来给从节点链接，以及提供心跳探测机制。
   2. Slave节点
      1. 开启一个独立的Netty进程，用于和Master节点建立连接，以及提供心跳探测机制。
      2. 初始化阶段，连接上Master节点，然后等待Master节点发送数据过来，发送数据过来后存储到本地内存即可。
2. 链式复制架构：确定一个头节点，接下来每次同步只需要将数据传递给它的下一个节点就可以了，但是整体链路的链路会比较长。
   1. Header节点：开启一个netty进程，主要的数据写入入口，往下一个节点复制即可。
   2. 非Header节点：开启一个Netty进程，接收上一个节点的数据，然后存储在内存中，并且往下一个节点写。


### 链式复制架构梳理

国外计算机科学家提出的一种数据复制过程中的强一致性方案：论文pdf地址：

在链式复制架构中，从头节点开始写入，直到数据写入到尾节点才算完成，这里面是一整个事务单元。读数据的时候，得从尾节点读取。因此整个处理链路下来，会涉及到非常多的网络开销，对于性能有一定影响。

假设分布式场景中，出现了节点中断怎么办？
- 头节点中断
- 尾节点中断
- 中间节点中断

优缺点：
- 单个尾节点存放了所有的数据内容，存在单点风险。
- 写入过程虽然是强一致性，但是性能开销会随着节点的增加而增加。
- 如果尾节点异常，只需要将尾节点的前置节点更替为最新的尾节点即可。
